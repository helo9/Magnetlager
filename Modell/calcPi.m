function y=calcPi(k2,n)
% Complete Elliptic Integral 3.Kind P(kˆ2,n)
% Input Range: 0<=k2<=1
% 0<=n<=1 n=lambda^2
% special cases: P(kˆ2,0)=K(k)
%		 		 P(kˆ2,1)=inf
%		 		 P(1,n)=inf
ca=10e-16; %accuracy

dim = size(k2);

%% siehe kommentar 1. Zeile (k^2)
k2 = k2.^2;

for ii = 1:dim(1)
	for jj = 1:dim(2)
		p=1-n(ii,jj);
		kc=sqrt(1-k2(ii,jj));

		if(p*kc ~= 0)	%n=1 or k=1
			m0=1;
			e0=kc;
	
			if(p>0)	%n<1
				p0=sqrt(p);
				c0=1;
				d0=1/p0;
			else %n>1
				g=1-p;
				f=kc*kc;
				p0=sqrt(f/g);
				c0=0;
				d0=-k2(ii,jj)/(g*p0);
			end %if

			while (abs(1-e0/m0)>ca)
				m1=e0+m0;
				e1=2*sqrt(e0*m0);
				p1=e0*m0/p0+p0;
				c1=d0/p0+c0;
				d1=2*(e0*m0/p0*c0+d0);
		
				m0=m1;
				e0=e1;
				p0=p1;
				c0=c1;
				d0=d1;
			end %while

			y(ii,jj)=0.5*pi*(c0*m0+d0)/(m0*(m0+p0));

		else
			y(ii,jj)=inf;
		end %if
		
	end %for
    %% 

end %for

end %function

%!test
%! # compares compelli3 Results width Mathematica Results
%! a=[0,0,0,0,0,0,0,0,0,0;0.09,0.09,0.09,0.09,0.09,0.09,0.09,0.09,0.09,0.09;0.18,0.18,0.18,0.18,0.18,0.18,0.18,0.18,0.18,0.18;0.27,0.27,0.27,0.27,0.27,0.27,0.27,0.27,0.27,0.27;0.36,0.36,0.36,0.36,0.36,0.36,0.36,0.36,0.36,0.36;0.45,0.45,0.45,0.45,0.45,0.45,0.45,0.45,0.45,0.45;0.54,0.54,0.54,0.54,0.54,0.54,0.54,0.54,0.54,0.54;0.63,0.63,0.63,0.63,0.63,0.63,0.63,0.63,0.63,0.63;0.72,0.72,0.72,0.72,0.72,0.72,0.72,0.72,0.72,0.72;0.81,0.81,0.81,0.81,0.81,0.81,0.81,0.81,0.81,0.81];
%! b=[0,0.09,0.18,0.27,0.36,0.45,0.54,0.63,0.72,0.81;0,0.09,0.18,0.27,0.36,0.45,0.54,0.63,0.72,0.81;0,0.09,0.18,0.27,0.36,0.45,0.54,0.63,0.72,0.81;0,0.09,0.18,0.27,0.36,0.45,0.54,0.63,0.72,0.81;0,0.09,0.18,0.27,0.36,0.45,0.54,0.63,0.72,0.81;0,0.09,0.18,0.27,0.36,0.45,0.54,0.63,0.72,0.81;0,0.09,0.18,0.27,0.36,0.45,0.54,0.63,0.72,0.81;0,0.09,0.18,0.27,0.36,0.45,0.54,0.63,0.72,0.81;0,0.09,0.18,0.27,0.36,0.45,0.54,0.63,0.72,0.81;0,0.09,0.18,0.27,0.36,0.45,0.54,0.63,0.72,0.81];
%! c3 = [1.5708,1.608,1.6497,1.6967,1.7508,1.8139,1.8895,1.9834,2.1059,2.2805;1.6466,1.6866,1.7314,1.782,1.8401,1.9082,1.9898,2.0912,2.2239,2.4134;1.7347,1.7779,1.8263,1.8811,1.9441,2.018,2.1067,2.2172,2.362,2.5693;1.8385,1.8856,1.9383,1.9982,2.0671,2.148,2.2454,2.3667,2.5263,2.7552;1.9635,2.0153,2.0735,2.1396,2.2158,2.3053,2.4133,2.5482,2.726,2.9821;2.1181,2.1759,2.2409,2.3148,2.4002,2.5007,2.6223,2.7745,2.9757,3.2665;2.316,2.3817,2.4556,2.5398,2.6373,2.7524,2.8918,3.067,3.2993,3.6368;2.5824,2.6589,2.7451,2.8436,2.9579,3.0931,3.2574,3.4647,3.7409,4.1443;2.9685,3.0611,3.1658,3.2856,3.425,3.5905,3.7926,4.0485,4.3915,4.8962;3.6037,3.7235,3.8594,4.0156,4.1981,4.4157,4.6827,5.0232,5.4831,6.1668];
%! res = calcPi(sqrt(b),a);
%! assert(c3,res,1e-4);
